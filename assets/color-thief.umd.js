!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.ColorThief=n()}(this,function(){if(!t)var t={map:function(t,n){var e={};return n?t.map(function(t,r){return e.index=r,n.call(e,t)}):t.slice()},naturalOrder:function(t,n){return t<n?-1:t>n?1:0},sum:function(t,n){var e={};return t.reduce(n?function(t,r,o){return e.index=o,t+n.call(e,r)}:function(t,n){return t+n},0)},max:function(n,e){return Math.max.apply(null,e?t.map(n,e):n)}};var n=function(){var n=5,e=8-n,r=1e3;function o(t,e,r){return(t<<2*n)+(e<<n)+r}function i(t){var n=[],e=!1;function r(){n.sort(t),e=!0}return{push:function(t){n.push(t),e=!1},peek:function(t){return e||r(),void 0===t&&(t=n.length-1),n[t]},pop:function(){return e||r(),n.pop()},size:function(){return n.length},map:function(t){return n.map(t)},debug:function(){return e||r(),n}}}function a(t,n,e,r,o,i,a){this.r1=t,this.r2=n,this.g1=e,this.g2=r,this.b1=o,this.b2=i,this.histo=a}function u(){this.vboxes=new i(function(n,e){return t.naturalOrder(n.vbox.count()*n.vbox.volume(),e.vbox.count()*e.vbox.volume())})}function s(n,e){if(e.count()){var r=e.r2-e.r1+1,i=e.g2-e.g1+1,a=t.max([r,i,e.b2-e.b1+1]);if(1==e.count())return[e.copy()];var u,s,h,c,f=0,v=[],l=[];if(a==r)for(u=e.r1;u<=e.r2;u++){for(c=0,s=e.g1;s<=e.g2;s++)for(h=e.b1;h<=e.b2;h++)c+=n[o(u,s,h)]||0;v[u]=f+=c}else if(a==i)for(u=e.g1;u<=e.g2;u++){for(c=0,s=e.r1;s<=e.r2;s++)for(h=e.b1;h<=e.b2;h++)c+=n[o(s,u,h)]||0;v[u]=f+=c}else for(u=e.b1;u<=e.b2;u++){for(c=0,s=e.r1;s<=e.r2;s++)for(h=e.g1;h<=e.g2;h++)c+=n[o(s,h,u)]||0;v[u]=f+=c}return v.forEach(function(t,n){l[n]=f-t}),function(t){var n,r,o,i,a,s=t+"1",h=t+"2",c=0;for(u=e[s];u<=e[h];u++)if(v[u]>f/2){for(o=e.copy(),i=e.copy(),a=(n=u-e[s])<=(r=e[h]-u)?Math.min(e[h]-1,~~(u+r/2)):Math.max(e[s],~~(u-1-n/2));!v[a];)a++;for(c=l[a];!c&&v[a-1];)c=l[--a];return o[h]=a,i[s]=o[h]+1,[o,i]}}(a==r?"r":a==i?"g":"b")}}return a.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(t){var n=this.histo;if(!this._count_set||t){var e,r,i,a=0;for(e=this.r1;e<=this.r2;e++)for(r=this.g1;r<=this.g2;r++)for(i=this.b1;i<=this.b2;i++)a+=n[o(e,r,i)]||0;this._count=a,this._count_set=!0}return this._count},copy:function(){return new a(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(t){var e=this.histo;if(!this._avg||t){var r,i,a,u,s=0,h=1<<8-n,c=0,f=0,v=0;for(i=this.r1;i<=this.r2;i++)for(a=this.g1;a<=this.g2;a++)for(u=this.b1;u<=this.b2;u++)s+=r=e[o(i,a,u)]||0,c+=r*(i+.5)*h,f+=r*(a+.5)*h,v+=r*(u+.5)*h;this._avg=s?[~~(c/s),~~(f/s),~~(v/s)]:[~~(h*(this.r1+this.r2+1)/2),~~(h*(this.g1+this.g2+1)/2),~~(h*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(t){var n=t[0]>>e;return gval=t[1]>>e,bval=t[2]>>e,n>=this.r1&&n<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},u.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var n=this.vboxes,e=0;e<n.size();e++)if(n.peek(e).vbox.contains(t))return n.peek(e).color;return this.nearest(t)},nearest:function(t){for(var n,e,r,o=this.vboxes,i=0;i<o.size();i++)((e=Math.sqrt(Math.pow(t[0]-o.peek(i).color[0],2)+Math.pow(t[1]-o.peek(i).color[1],2)+Math.pow(t[2]-o.peek(i).color[2],2)))<n||void 0===n)&&(n=e,r=o.peek(i).color);return r},forcebw:function(){var n=this.vboxes;n.sort(function(n,e){return t.naturalOrder(t.sum(n.color),t.sum(e.color))});var e=n[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(n[0].color=[0,0,0]);var r=n.length-1,o=n[r].color;o[0]>251&&o[1]>251&&o[2]>251&&(n[r].color=[255,255,255])}},{quantize:function(h,c){if(!h.length||c<2||c>256)return!1;var f=function(t){var r,i=new Array(1<<3*n);return t.forEach(function(t){r=o(t[0]>>e,t[1]>>e,t[2]>>e),i[r]=(i[r]||0)+1}),i}(h);f.forEach(function(){});var v=function(t,n){var r,o,i,u=1e6,s=0,h=1e6,c=0,f=1e6,v=0;return t.forEach(function(t){(r=t[0]>>e)<u?u=r:r>s&&(s=r),(o=t[1]>>e)<h?h=o:o>c&&(c=o),(i=t[2]>>e)<f?f=i:i>v&&(v=i)}),new a(u,s,h,c,f,v,n)}(h,f),l=new i(function(n,e){return t.naturalOrder(n.count(),e.count())});function g(t,n){for(var e,o=t.size(),i=0;i<r;){if(o>=n)return;if(i++>r)return;if((e=t.pop()).count()){var a=s(f,e),u=a[0],h=a[1];if(!u)return;t.push(u),h&&(t.push(h),o++)}else t.push(e),i++}}l.push(v),g(l,.75*c);for(var p=new i(function(n,e){return t.naturalOrder(n.count()*n.volume(),e.count()*e.volume())});l.size();)p.push(l.pop());g(p,c);for(var d=new u;p.size();)d.push(p.pop());return d}}}().quantize,e=function(t){"CANVAS"===t.nodeName?(this.canvas=t,this.context=t.getContext("2d"),this.width=t.width,this.height=t.height):"VIDEO"===t.nodeName?(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=video.videoWidth,this.height=this.canvas.height=t.videoHeight,this.context.drawImage(t,0,0,this.width,this.height)):(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height))};e.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var r=function(){};return r.prototype.getColor=function(t,n){return void 0===n&&(n=10),this.getPalette(t,5,n)[0]},r.prototype.getPalette=function(t,r,o){var i=function(t){var n=t.colorCount,e=t.quality;if(void 0!==n&&Number.isInteger(n)){if(1===n)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");n=Math.max(n,2),n=Math.min(n,20)}else n=10;return(void 0===e||!Number.isInteger(e)||e<1)&&(e=10),{colorCount:n,quality:e}}({colorCount:r,quality:o}),a=new e(t),u=function(t,n,e){for(var r=t,o=[],i=0,a=void 0,u=void 0,s=void 0,h=void 0,c=void 0;i<n;i+=e)u=r[0+(a=4*i)],s=r[a+1],h=r[a+2],(void 0===(c=r[a+3])||c>=125)&&(u>250&&s>250&&h>250||o.push([u,s,h]));return o}(a.getImageData().data,a.width*a.height,i.quality),s=n(u,i.colorCount);return s?s.palette():null},r.prototype.getColorFromUrl=function(t,n,e){var r=this,o=document.createElement("img");o.addEventListener("load",function(){var i=r.getPalette(o,5,e);n(i[0],t)}),o.src=t},r.prototype.getImageData=function(t,n){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){if(200==this.status){var t=new Uint8Array(this.response);i=t.length;for(var e=new Array(i),r=0;r<t.length;r++)e[r]=String.fromCharCode(t[r]);var o=e.join(""),a=window.btoa(o);n("data:image/png;base64,"+a)}},e.send()},r.prototype.getColorAsync=function(t,n,e){var r=this;this.getImageData(t,function(t){var o=document.createElement("img");o.addEventListener("load",function(){var t=r.getPalette(o,5,e);n(t[0],this)}),o.src=t})},r});
